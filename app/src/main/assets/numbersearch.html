<!DOCTYPE html>
<html xmls="http://www.w3.org/1999/xhtml" lang="ko" xml:lang="ko">
<head>
    <script src="https://code.jquery.com/jquery-3.6.0.js" crossorigin="anonymous"></script>
    <meta name="viewport" content="initial-scale=1.0">
</head>
<body>
<tr align="center">
    <td>
        <div id="search_main_box">
            <div style="border: solid 8px #F9B530;">
                <input class="search_input" id="search_text" type="number" value="" autocomplete="off" autocorrect="off" maxlength="255" data-initval="" placeholder="전화번호를 검색하세요">
                <img class="search_button" id="search_btn" title="검색버튼" onclick="chkSearch()" src="http://www.moyaweb.com/images/img_search.png">
            </div>
        </div>
        <div id="search_error" style="text-align: center; font-size: 12px; color: rgb(244, 127, 117); font-weight: bold;"></div>
    </td>
</tr>
<tr align="center">
    <td>
        <div id="result_main_view" style="display: none;">
        </div>
    </td>
</tr>
<script type="text/javascript">
            $(document).ready(function(){
                $(window).resize(chkResize);
                chkResize();
            });

            var cur_resize_type = "";
            function chkResize(){
                var testWidth = $('body').width();
                if(testWidth < 1000){
                    if(cur_resize_type == "mobile"){
                        return;
                    }
                    //reloadMenu("mobile");

                    cur_resize_type = "mobile";
                }else{
                    if(cur_resize_type == "main"){
                        return;
                    }
                    //reloadMenu("main");

                    cur_resize_type = "main";
                }
            }

            function goMain(){
                if(cur_resize_type == "mobile"){
                    window.location.href = "main.do";
                }else{
                    window.location.href = "main.do";
                }
            }

            var FLG_SCH = false;
            function chkSearch(){
                var getSchTelno = "";
                getSchTelno = $("#search_text").val();

                var pattern = /^[0-9-+]+$/;
                var chkflg = (pattern.test(getSchTelno)) ? false : true;
                var chklen = (getSchTelno != null) ? getSchTelno.length : 0;

                if(getSchTelno == null || getSchTelno == "" || getSchTelno == "전화번호를 검색하세요."){
                    //검색할 전화번호를 입력해주세요
                    $("#search_error").html("전화번호를 입력해주세요!!");
                    $("#search_error").show(200);
                    return;
                }else if(chklen < 3 || chklen > 20){
                    //전화번호는 3~20자리로 입력해주세요
                    $("#search_error").html("전화번호는 3~20자리로 입력해주세요");
                    $("#search_error").show(200);
                    return;
                }else if(chkflg){
                    //숫자, 하이픈('-')만 입력해주세요
                    $("#search_error").html("숫자, 하이픈('-')만 입력해주세요");
                    $("#search_error").show(200);
                    return;
                }

                $("#search_error").hide();
                $("#search_text").blur();

                $.ajax({
                    type:'POST',
                    data:({}),
                    url:'http://www.moyaweb.com/check_search.tx',
                    async:true,
                    beforeSend:function(){

                    },
                    complete:function(){
                    },
                    error:function(e){

                    },
                    timeout:2500,
                    dataType:"text",
                    success: function(ret){
                        if(ret == "SCH_LIMIT"){
                            $("#search_error").html("전화번호 검색은 일일 조회횟수 제한이 있습니다");
                            $("#search_error").show(200);

                        }else if(ret == "ERROR"){
                            $("#search_error").html("검색중 오류가 발생했습니다. 오류가 지속되는 경우 관리자에게 문의해주세요");
                            $("#search_error").show(200);

                        }else{
                            searchMain();
                        }
                    }
                });
            }

            function searchMain(){
                var getSchTelno = $("#search_text").val();

                $.ajax({
                    type:'POST',
                    timeout:2500,
                    data:({SCH_TEL_NO:getSchTelno}),
                    url:'http://www.moyaweb.com/search_result.do',
                    async:true,
                    beforeSend:function(){
                    },
                    complete:function(){

                    },
                    error:function(e){

                    },
                    dataType:"html",
                    success: function(html){
                        $("#search_text").val("");
                        if(FLG_SCH){
                            $("#result_main_view").hide();
                        }
                        FLG_SCH = true;
                        $("#result_main_view").show(300);
                        $("#result_main_view").html(html);
                    }
                });
            }
        </script>
</body>
</html>
